<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sanj Healthcare - Doctor Agreements</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../css/design-system.css">
<link rel="stylesheet" href="../css/components.css">
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
  h1 { text-align: center; margin-top: 20px; color: #333; }
  
  /* Summary Cards */
  .summary-cards { 
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
    gap: 20px; 
    margin: 20px auto; 
    max-width: 1200px;
  }
  .summary-card { 
    background: #fff; 
    padding: 20px; 
    border-radius: 10px; 
    box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
    text-align: center;
  }
  .summary-card h3 { margin: 0 0 10px 0; color: #666; font-size: 14px; }
  .summary-card .value { font-size: 24px; font-weight: bold; color: #2196F3; }
  
  /* Action Buttons */
  .action-buttons { 
    max-width: 1200px; 
    margin: 20px auto; 
    display: flex; 
    gap: 10px; 
  }
  .btn { 
    padding: 10px 20px; 
    border: none; 
    border-radius: 5px; 
    cursor: pointer; 
    font-size: 14px; 
  }
  .add-btn { background: #4CAF50; color: white; }
  .filter-btn { background: #2196F3; color: white; }
  .cancel-btn { background: #6c757d; color: white; }
  
  /* Agreement Form */
  #agreementForm { 
    display: none; 
    max-width: 600px; 
    margin: 20px auto; 
    background: #fff; 
    padding: 25px; 
    border-radius: 10px; 
    box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
  }
  .form-grid { 
    display: grid; 
    grid-template-columns: 1fr 1fr; 
    gap: 15px; 
  }
  .form-group { margin-bottom: 15px; }
  .form-group.full-width { grid-column: 1 / -1; }
  .form-group label { display: block; margin-bottom: 5px; font-weight: 500; color: #333; }
  .form-group input, .form-group select, .form-group textarea { 
    width: 100%; 
    padding: 10px; 
    border: 1px solid #ddd; 
    border-radius: 5px; 
    font-size: 14px; 
  }
  .form-group textarea { height: 80px; resize: vertical; }
  .form-buttons { 
    display: flex; 
    gap: 10px; 
    margin-top: 20px; 
    grid-column: 1 / -1; 
  }
  
  /* Agreements Table */
  .container { max-width: 1200px; margin: 20px auto; }
  table { 
    width: 100%; 
    border-collapse: collapse; 
    background: #fff; 
    border-radius: 10px; 
    overflow: hidden; 
    box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
  }
  th, td { 
    padding: 12px; 
    border-bottom: 1px solid #eee; 
    text-align: left; 
  }
  th { 
    background: #2196F3; 
    color: white; 
    font-weight: 600; 
    cursor: pointer;
  }
  th:hover { background: #1976D2; }
  
  /* Color Coding */
  tr.performing-well { background: #d4edda; } /* Green - Return ‚â• Paid */
  tr.underperforming { background: #f8d7da; } /* Red - Return < Paid */
  tr.needs-review { background: #fff3cd; } /* Yellow - Expired/Review */
  tr.completed { background: #e2e3e5; } /* Gray - Completed */
  
  /* Status Badges */
  .status-badge { 
    padding: 4px 8px; 
    border-radius: 12px; 
    font-size: 12px; 
    font-weight: 500; 
  }
  .status-active { background: #d4edda; color: #155724; }
  .status-completed { background: #e2e3e5; color: #383d41; }
  .status-discontinued { background: #f8d7da; color: #721c24; }
  
  /* Action Buttons in Table */
  .action-cell { white-space: nowrap; }
  .edit-btn { background: #2196F3; color: white; }
  .delete-btn { background: #f44336; color: white; }
  
  /* Filter Section */
  #filterSection { 
    display: none; 
    max-width: 1200px; 
    margin: 20px auto; 
    background: #fff; 
    padding: 20px; 
    border-radius: 10px; 
    box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
  }
  .filter-grid { 
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
    gap: 15px; 
  }
  
  /* Loading States */
  .loading { text-align: center; padding: 40px; color: #6c757d; }
  .error-message { 
    background: #f8d7da; 
    color: #721c24; 
    padding: 15px; 
    border-radius: 5px; 
    margin: 10px 0; 
    text-align: center; 
  }
</style>
</head>
<body>

<!-- Header Section -->
<h1>Marketing ‚Äì Doctor Agreements</h1>

<!-- Summary Cards -->
<div class="summary-cards">
  <div class="summary-card">
    <h3>Total Agreements</h3>
    <div class="value" id="totalAgreements">0</div>
  </div>
  <div class="summary-card">
    <h3>Total Marketing Expense</h3>
    <div class="value">‚Çπ<span id="totalExpense">0</span></div>
  </div>
  <div class="summary-card">
    <h3>Under Review / Discontinued</h3>
    <div class="value" id="reviewCount">0</div>
  </div>
</div>

<!-- Action Buttons -->
<div class="action-buttons">
  <button class="btn add-btn" onclick="showAgreementForm()">+ Add Agreement</button>
  <button class="btn filter-btn" onclick="toggleFilterSection()">üîç Filter Agreements</button>
</div>

<!-- Filter Section -->
<div id="filterSection">
  <h3>Filter Agreements</h3>
  <div class="filter-grid">
    <div class="form-group">
      <label>Status</label>
      <select id="filterStatus" onchange="applyFilters()">
        <option value="">All Status</option>
        <option value="active">Active</option>
        <option value="completed">Completed</option>
        <option value="discontinued">Discontinued</option>
      </select>
    </div>
    <div class="form-group">
      <label>Doctor</label>
      <select id="filterDoctor" onchange="applyFilters()">
        <option value="">All Doctors</option>
      </select>
    </div>
    <div class="form-group">
      <label>Date Range</label>
      <input type="date" id="filterStartDate" onchange="applyFilters()">
      <input type="date" id="filterEndDate" onchange="applyFilters()" style="margin-top: 5px;">
    </div>
    <div class="form-group">
      <label>Performance</label>
      <select id="filterPerformance" onchange="applyFilters()">
        <option value="">All</option>
        <option value="performing">Performing Well</option>
        <option value="underperforming">Underperforming</option>
      </select>
    </div>
  </div>
</div>

<!-- Add/Edit Agreement Form -->
<div id="agreementForm">
  <h3 id="formTitle">Add Doctor Agreement</h3>
  <input type="hidden" id="agreementId">
  
  <div class="form-grid">
    <div class="form-group">
      <label>Doctor Name *</label>
      <select id="doctorName" required>
        <option value="">Select Doctor</option>
        <!-- Dynamic options will be loaded -->
      </select>
    </div>
    
    <div class="form-group">
      <label>Agreement Start Date *</label>
      <input type="date" id="startDate" required>
    </div>
    
    <div class="form-group">
      <label>Agreement End Date *</label>
      <input type="date" id="endDate" required>
    </div>
    
    <div class="form-group">
      <label>Agreement Amount (‚Çπ) *</label>
      <input type="number" id="agreementAmount" step="0.01" min="0" required>
    </div>
    
    <div class="form-group">
      <label>Payment Frequency *</label>
      <select id="paymentFrequency" required>
        <option value="">Select Frequency</option>
        <option value="monthly">Monthly</option>
        <option value="quarterly">Quarterly</option>
        <option value="one-time">One-Time</option>
      </select>
    </div>
    
    <div class="form-group">
      <label>Paid Amount (‚Çπ)</label>
      <input type="number" id="paidAmount" step="0.01" min="0" oninput="updatePendingAmount()">
    </div>
    
    <div class="form-group">
      <label>Pending Amount (‚Çπ)</label>
      <input type="number" id="pendingAmount" step="0.01" readonly>
    </div>
    
    <div class="form-group">
      <label>Return Value (‚Çπ)</label>
      <input type="number" id="returnValue" step="0.01" min="0">
    </div>
    
    <div class="form-group">
      <label>Status *</label>
      <select id="status" required>
        <option value="active">Active</option>
        <option value="completed">Completed</option>
        <option value="discontinued">Discontinued</option>
      </select>
    </div>
    
    <div class="form-group full-width">
      <label>Notes</label>
      <textarea id="notes" placeholder="Additional notes about this agreement..."></textarea>
    </div>
  </div>
  
  <div class="form-buttons">
    <button class="btn add-btn" onclick="saveAgreement()">Save Agreement</button>
    <button class="btn cancel-btn" onclick="hideAgreementForm()">Cancel</button>
  </div>
</div>

<!-- Agreements Table -->
<div class="container">
  <table id="agreementsTable">
    <thead>
      <tr>
        <th data-sort="doctorName">Doctor Name</th>
        <th data-sort="startDate">Agreement Period</th>
        <th data-sort="agreementAmount">Agreement Amount</th>
        <th data-sort="paidAmount">Paid Amount</th>
        <th data-sort="pendingAmount">Pending Amount</th>
        <th data-sort="returnValue">Return Value</th>
        <th data-sort="status">Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="agreementsTableBody">
      <!-- Dynamic content will be loaded here -->
    </tbody>
  </table>
</div>

<script src="../js/firebase-config.js"></script>
<script src="../js/navigation.js"></script>
<script src="../js/marketing.js"></script>

</body>
</html>