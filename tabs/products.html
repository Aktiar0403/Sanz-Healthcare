<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sanj Healthcare - Products</title>
<link rel="stylesheet" href="../css/tabs.css">
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="../js/firebase-config.js"></script>
<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
  h1 { text-align:center; margin-top:20px; }
  .container { max-width: 1200px; margin: 20px auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
  .card { background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); position: relative; }
  .bonus { position: absolute; top: 10px; right: 10px; background: #ff6347; color: #fff; padding: 5px 10px; border-radius: 5px; font-size: 0.85em; }
  .product-name { font-weight: bold; font-size: 1.1em; margin-bottom: 5px; }
  .description { font-size: 0.9em; margin-bottom: 10px; color: #555; }
  .price, .stock, .supplier, .gst, .batch, .expiry { font-size: 0.9em; margin-bottom: 3px; color: #333; }
  .btn { padding: 5px 10px; margin: 3px; border: none; border-radius: 5px; cursor: pointer; }
  .edit-btn { background: #4CAF50; color: white; }
  .delete-btn { background: #f44336; color: white; }
  .add-btn { background: #2196F3; color: white; margin: 20px auto; display: block; }
  .summary { max-width: 1200px; margin: 20px auto; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  #productForm { display: none; max-width: 400px; margin: 20px auto; background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  #productForm input, #productForm select { width: 100%; margin: 5px 0; padding: 5px; }
  #formTitle { text-align:center; margin-bottom:10px; font-weight:bold; }
</style>
</head>
<body>

<h1>Sanj Healthcare Products</h1>

<button class="add-btn" onclick="showAddForm()">+ Add New Product</button>

<div id="productForm">
  <div id="formTitle">Add Product</div>
  <input type="hidden" id="productId">
  <input type="text" id="name" placeholder="Product Name">
  <input type="text" id="batch" placeholder="Batch">
  <input type="date" id="expiry" placeholder="Expiry Date">
  <input type="number" id="mrp" placeholder="MRP">
  <input type="number" id="gst" placeholder="GST (%)">
  <input type="number" id="retailerPrice" placeholder="Retailer Price">
  <input type="number" id="stockistPrice" placeholder="Stockist Price">
  <input type="number" id="supplierPrice" placeholder="Supplier Price">
  <input type="text" id="bonus" placeholder="Bonus">
  <input type="number" id="stock" placeholder="Stock Quantity">
  <input type="text" id="category" placeholder="Category">
  <input type="text" id="description" placeholder="Description">
  <button class="btn add-btn" onclick="saveProduct()">Save</button>
  <button class="btn delete-btn" onclick="hideForm()">Cancel</button>
</div>

<div class="container" id="productContainer"></div>

<div class="summary" id="summaryContainer">
  <h2>Calculation Summary</h2>
  <p>Total Supplier Cost: ₹<span id="totalSupplier">0</span></p>
  <p>CNF Charges: ₹<span id="totalCNF">0</span></p>
  <p>Delivery Charges: ₹<span id="totalDelivery">0</span></p>
  <p><strong>Grand Total: ₹<span id="grandTotal">0</span></strong></p>
</div>

<script src="../js/products.js"></script>
<script>
const container = document.getElementById('productContainer');
const totalSupplierElem = document.getElementById('totalSupplier');
const totalCNFElem = document.getElementById('totalCNF');
const totalDeliveryElem = document.getElementById('totalDelivery');
const grandTotalElem = document.getElementById('grandTotal');

let editMode = false;

function renderProducts() {
  container.innerHTML = '';
  let totalSupplier = 0;

  products.forEach(product => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <div class="bonus">${product.bonus}</div>
      <div class="product-name">${product.name}</div>
      <div class="description">${product.description}</div>
      <div class="price">MRP: ₹${product.mrp.toFixed(2)}</div>
      <div class="price">Retailer Price: ₹${product.retailerPrice.toFixed(2)}</div>
      <div class="price">Stockist Price: ₹${product.stockistPrice.toFixed(2)}</div>
      <div class="supplier">Supplier Price: ₹${product.supplierPrice.toFixed(2)}</div>
      <div class="gst">GST: ${product.gst}%</div>
      <div class="stock">Stock: ${product.stock}</div>
      <div class="batch">Batch: ${product.batch}</div>
      <div class="expiry">Expiry: ${product.expiry}</div>
      <button class="btn edit-btn" onclick="editProduct(${product.id})">Edit</button>
      <button class="btn delete-btn" onclick="deleteProductCard(${product.id})">Delete</button>
    `;
    container.appendChild(card);
    totalSupplier += product.supplierPrice * product.stock;
  });

  totalSupplierElem.textContent = totalSupplier.toFixed(2);
  totalCNFElem.textContent = cnfCharge.toFixed(2);
  totalDeliveryElem.textContent = deliveryCharge.toFixed(2);
  grandTotalElem.textContent = (totalSupplier + cnfCharge + deliveryCharge).toFixed(2);
}

// Show Add Product Form
function showAddForm() {
  editMode = false;
  document.getElementById('formTitle').textContent = "Add Product";
  document.getElementById('productForm').style.display = 'block';
  document.getElementById('productId').value = '';
  document.querySelectorAll('#productForm input').forEach(input => { if(input.id!=='productId') input.value = ''; });
}

// Hide Form
function hideForm() {
  document.getElementById('productForm').style.display = 'none';
}

// Save Product (Add or Update)
function saveProduct() {
  const productId = editMode ? parseInt(document.getElementById('productId').value) : Date.now();
  const newProduct = {
    id: productId,
    name: document.getElementById('name').value,
    batch: document.getElementById('batch').value,
    expiry: document.getElementById('expiry').value,
    mrp: parseFloat(document.getElementById('mrp').value),
    gst: parseFloat(document.getElementById('gst').value),
    retailerPrice: parseFloat(document.getElementById('retailerPrice').value),
    stockistPrice: parseFloat(document.getElementById('stockistPrice').value),
    supplierPrice: parseFloat(document.getElementById('supplierPrice').value),
    bonus: document.getElementById('bonus').value,
    stock: parseInt(document.getElementById('stock').value),
    category: document.getElementById('category').value,
    description: document.getElementById('description').value
  };

  if(editMode){
    const index = products.findIndex(p=>p.id===productId);
    products[index] = newProduct;
    // Firestore update
    db.collection("products").doc(productId.toString()).update(newProduct);
  } else {
    products.push(newProduct);
    // Firestore add
    db.collection("products").doc(productId.toString()).set(newProduct);
  }

  hideForm();
  renderProducts();
}

// Edit Product
function editProduct(id) {
  editMode = true;
  const product = products.find(p=>p.id===id);
  document.getElementById('formTitle').textContent = "Edit Product";
  document.getElementById('productForm').style.display = 'block';
  document.getElementById('productId').value = product.id;
  document.getElementById('name').value = product.name;
  document.getElementById('batch').value = product.batch;
  document.getElementById('expiry').value = product.expiry;
  document.getElementById('mrp').value = product.mrp;
  document.getElementById('gst').value = product.gst;
  document.getElementById('retailerPrice').value = product.retailerPrice;
  document.getElementById('stockistPrice').value = product.stockistPrice;
  document.getElementById('supplierPrice').value = product.supplierPrice;
  document.getElementById('bonus').value = product.bonus;
  document.getElementById('stock').value = product.stock;
  document.getElementById('category').value = product.category;
  document.getElementById('description').value = product.description;
}

// Delete Product
function deleteProductCard(id){
  if(confirm("Are you sure you want to delete this product?")){
    const index = products.findIndex(p=>p.id===id);
    if(index>-1) products.splice(index,1);
    // Firestore delete
    db.collection("products").doc(id.toString()).delete();
    renderProducts();
  }
}

// Initial render
renderProducts();
</script>
<script src="../js/products.js"></script>

</body>
</html>
