<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sanj Healthcare - Reports & Analytics</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../css/design-system.css">
<link rel="stylesheet" href="../css/components.css">
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
  h1 { text-align: center; margin-top: 20px; color: #333; }
  
  /* Control Panel */
  .control-panel {
    max-width: 1200px;
    margin: 20px auto;
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  .filter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 15px;
  }
  .form-group { margin-bottom: 15px; }
  .form-group label { display: block; margin-bottom: 5px; font-weight: 500; color: #333; }
  .form-group input, .form-group select { 
    width: 100%; 
    padding: 10px; 
    border: 1px solid #ddd; 
    border-radius: 5px; 
    font-size: 14px; 
  }
  .action-buttons {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  .btn { 
    padding: 12px 20px; 
    border: none; 
    border-radius: 5px; 
    cursor: pointer; 
    font-size: 14px; 
    font-weight: 500;
  }
  .generate-btn { background: #4CAF50; color: white; }
  .export-btn { background: #2196F3; color: white; }
  .print-btn { background: #FF9800; color: white; }
  
  /* KPI Cards */
  .kpi-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin: 20px auto;
    max-width: 1200px;
  }
  .kpi-card {
    background: #fff;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    text-align: center;
    border-left: 4px solid;
  }
  .kpi-card.revenue { border-left-color: #4CAF50; }
  .kpi-card.expenses { border-left-color: #f44336; }
  .kpi-card.profit { border-left-color: #FF9800; }
  .kpi-card.stock { border-left-color: #2196F3; }
  .kpi-card h3 { margin: 0 0 10px 0; color: #666; font-size: 14px; text-transform: uppercase; }
  .kpi-card .value { font-size: 28px; font-weight: bold; margin-bottom: 5px; }
  .kpi-card .trend { font-size: 12px; color: #666; }
  .trend.positive { color: #4CAF50; }
  .trend.negative { color: #f44336; }
  
  /* Charts Container */
  .charts-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: 20px;
    margin: 20px auto;
    max-width: 1200px;
  }
  .chart-card {
    background: #fff;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  .chart-card h3 {
    margin: 0 0 20px 0;
    color: #333;
    text-align: center;
    font-size: 16px;
  }
  .chart-container {
    position: relative;
    height: 300px;
  }
  
  /* Reports Grid */
  .reports-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 20px;
    margin: 20px auto;
    max-width: 1200px;
  }
  .report-card {
    background: #fff;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  .report-card h3 {
    margin: 0 0 15px 0;
    color: #333;
    border-bottom: 2px solid #f0f0f0;
    padding-bottom: 10px;
  }
  .report-list {
    max-height: 300px;
    overflow-y: auto;
  }
  .report-item {
    padding: 10px;
    border-bottom: 1px solid #f0f0f0;
    display: flex;
    justify-content: between;
    align-items: center;
  }
  .report-item:last-child {
    border-bottom: none;
  }
  .report-item .name {
    flex: 1;
    font-weight: 500;
  }
  .report-item .value {
    font-weight: bold;
    color: #2196F3;
  }
  .report-item .trend {
    font-size: 12px;
    margin-left: 10px;
  }
  
  /* Performance Indicators */
  .performance-indicators {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin: 20px auto;
    max-width: 1200px;
  }
  .indicator-card {
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  .indicator-card h4 {
    margin: 0 0 15px 0;
    color: #333;
    font-size: 14px;
  }
  .indicator-value {
    font-size: 24px;
    font-weight: bold;
    text-align: center;
    margin-bottom: 10px;
  }
  .indicator-bar {
    background: #f0f0f0;
    height: 8px;
    border-radius: 4px;
    overflow: hidden;
  }
  .indicator-fill {
    height: 100%;
    border-radius: 4px;
  }
  .fill-good { background: #4CAF50; }
  .fill-average { background: #FF9800; }
  .fill-poor { background: #f44336; }
  
  /* Loading States */
  .loading {
    text-align: center;
    padding: 40px;
    color: #6c757d;
  }
  .error-message {
    background: #f8d7da;
    color: #721c24;
    padding: 15px;
    border-radius: 5px;
    margin: 10px 0;
    text-align: center;
  }
  
  /* Responsive */
  @media (max-width: 768px) {
    .charts-container {
      grid-template-columns: 1fr;
    }
    .charts-container .chart-card {
      min-width: 100%;
    }
    .reports-grid {
      grid-template-columns: 1fr;
    }
    .filter-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>

<!-- Header Section -->
<h1>Reports & Analytics Dashboard</h1>

<!-- Control Panel -->
<div class="control-panel">
  <h3>Report Parameters</h3>
  <div class="filter-grid">
    <div class="form-group">
      <label>Report Period</label>
      <select id="reportPeriod">
        <option value="last7">Last 7 Days</option>
        <option value="last30" selected>Last 30 Days</option>
        <option value="last90">Last 90 Days</option>
        <option value="last365">Last 365 Days</option>
        <option value="custom">Custom Range</option>
      </select>
    </div>
    <div class="form-group">
      <label>Start Date</label>
      <input type="date" id="startDate">
    </div>
    <div class="form-group">
      <label>End Date</label>
      <input type="date" id="endDate">
    </div>
    <div class="form-group">
      <label>Report Type</label>
      <select id="reportType">
        <option value="overview">Overview Dashboard</option>
        <option value="sales">Sales Performance</option>
        <option value="inventory">Inventory Analysis</option>
        <option value="marketing">Marketing ROI</option>
        <option value="financial">Financial Summary</option>
      </select>
    </div>
  </div>
  <div class="action-buttons">
    <button class="btn generate-btn" onclick="generateReports()">üìä Generate Reports</button>
    <button class="btn export-btn" onclick="exportToExcel()">üì• Export to Excel</button>
    <button class="btn print-btn" onclick="printReports()">üñ®Ô∏è Print Reports</button>
  </div>
</div>

<!-- KPI Cards -->
<div class="kpi-cards">
  <div class="kpi-card revenue">
    <h3>Total Revenue</h3>
    <div class="value">‚Çπ<span id="kpiRevenue">0</span></div>
    <div class="trend" id="revenueTrend">+0% vs previous period</div>
  </div>
  <div class="kpi-card expenses">
    <h3>Total Expenses</h3>
    <div class="value">‚Çπ<span id="kpiExpenses">0</span></div>
    <div class="trend" id="expensesTrend">+0% vs previous period</div>
  </div>
  <div class="kpi-card profit">
    <h3>Net Profit</h3>
    <div class="value">‚Çπ<span id="kpiProfit">0</span></div>
    <div class="trend" id="profitTrend">+0% vs previous period</div>
  </div>
  <div class="kpi-card stock">
    <h3>Stock Value</h3>
    <div class="value">‚Çπ<span id="kpiStock">0</span></div>
    <div class="trend" id="stockTrend">+0% vs previous period</div>
  </div>
</div>

<!-- Charts Section -->
<div class="charts-container">
  <div class="chart-card">
    <h3>Revenue vs Expenses Trend</h3>
    <div class="chart-container">
      <canvas id="revenueExpenseChart"></canvas>
    </div>
  </div>
  <div class="chart-card">
    <h3>Sales by Product Category</h3>
    <div class="chart-container">
      <canvas id="salesByCategoryChart"></canvas>
    </div>
  </div>
  <div class="chart-card">
    <h3>Stock Levels & Movement</h3>
    <div class="chart-container">
      <canvas id="stockMovementChart"></canvas>
    </div>
  </div>
  <div class="chart-card">
    <h3>Marketing ROI by Doctor</h3>
    <div class="chart-container">
      <canvas id="marketingROIChart"></canvas>
    </div>
  </div>
</div>

<!-- Performance Reports -->
<div class="reports-grid">
  <!-- Top Products -->
  <div class="report-card">
    <h3>üèÜ Top Performing Products</h3>
    <div class="report-list" id="topProductsList">
      <div class="loading">Loading top products...</div>
    </div>
  </div>
  
  <!-- Stock Alerts -->
  <div class="report-card">
    <h3>‚ö†Ô∏è Stock Alerts</h3>
    <div class="report-list" id="stockAlertsList">
      <div class="loading">Checking stock levels...</div>
    </div>
  </div>
  
  <!-- Marketing Performance -->
  <div class="report-card">
    <h3>üìà Marketing Performance</h3>
    <div class="report-list" id="marketingPerformanceList">
      <div class="loading">Analyzing marketing data...</div>
    </div>
  </div>
  
  <!-- Expense Breakdown -->
  <div class="report-card">
    <h3>üí∞ Expense Breakdown</h3>
    <div class="report-list" id="expenseBreakdownList">
      <div class="loading">Calculating expenses...</div>
    </div>
  </div>
</div>

<!-- Performance Indicators -->
<div class="performance-indicators">
  <div class="indicator-card">
    <h4>Inventory Turnover Ratio</h4>
    <div class="indicator-value" id="turnoverRatio">0.0</div>
    <div class="indicator-bar">
      <div class="indicator-fill fill-average" id="turnoverBar" style="width: 0%"></div>
    </div>
    <div style="font-size: 12px; color: #666; text-align: center; margin-top: 5px;">
      <span id="turnoverStatus">Calculating...</span>
    </div>
  </div>
  
  <div class="indicator-card">
    <h4>Doctor Agreement ROI</h4>
    <div class="indicator-value" id="doctorROI">0%</div>
    <div class="indicator-bar">
      <div class="indicator-fill fill-average" id="doctorROIBar" style="width: 0%"></div>
    </div>
    <div style="font-size: 12px; color: #666; text-align: center; margin-top: 5px;">
      <span id="doctorROIStatus">Calculating...</span>
    </div>
  </div>
  
  <div class="indicator-card">
    <h4>Profit Margin</h4>
    <div class="indicator-value" id="profitMargin">0%</div>
    <div class="indicator-bar">
      <div class="indicator-fill fill-average" id="profitMarginBar" style="width: 0%"></div>
    </div>
    <div style="font-size: 12px; color: #666; text-align: center; margin-top: 5px;">
      <span id="profitMarginStatus">Calculating...</span>
    </div>
  </div>
  
  <div class="indicator-card">
    <h4>Scheme Effectiveness</h4>
    <div class="indicator-value" id="schemeEffectiveness">0%</div>
    <div class="indicator-bar">
      <div class="indicator-fill fill-average" id="schemeEffectivenessBar" style="width: 0%"></div>
    </div>
    <div style="font-size: 12px; color: #666; text-align: center; margin-top: 5px;">
      <span id="schemeEffectivenessStatus">Calculating...</span>
    </div>
  </div>
</div>

<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!-- Include Excel export library -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<script src="../js/firebase-config.js"></script>
<script src="../js/navigation.js"></script>
<script src="../js/reports.js"></script>

<script>
// Set default dates
document.addEventListener('DOMContentLoaded', function() {
  const endDate = new Date();
  const startDate = new Date();
  startDate.setDate(startDate.getDate() - 30);
  
  document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
  document.getElementById('startDate').value = startDate.toISOString().split('T')[0];
  
  // Generate initial reports
  setTimeout(() => generateReports(), 1000);
});

// Handle period change
document.getElementById('reportPeriod').addEventListener('change', function() {
  const period = this.value;
  const endDate = new Date();
  const startDate = new Date();
  
  switch(period) {
    case 'last7':
      startDate.setDate(startDate.getDate() - 7);
      break;
    case 'last30':
      startDate.setDate(startDate.getDate() - 30);
      break;
    case 'last90':
      startDate.setDate(startDate.getDate() - 90);
      break;
    case 'last365':
      startDate.setDate(startDate.getDate() - 365);
      break;
    case 'custom':
      // Don't change dates for custom
      return;
  }
  
  document.getElementById('startDate').value = startDate.toISOString().split('T')[0];
  document.getElementById('endDate').value = endDate.toISOString().split('T')[0];
});
</script>

</body>
</html>