<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sanj Healthcare - Stock Management</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../css/design-system.css">
<link rel="stylesheet" href="../css/components.css">
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
  h1 { text-align:center; margin-top:20px; }
  .container { max-width: 1400px; margin: 20px auto; }
  table { width: 100%; border-collapse: collapse; background: #fff; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: center; }
  th { background: #2196F3; color: white; }
  tr.low-stock td { background: #ffe0e0; }
  tr.expired td { background: #ffcccc; }
  tr.scheme-sale td { background: #f0f8ff; }
  .btn { padding: 8px 16px; margin: 2px; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; }
  .add-btn { background: #4CAF50; color: white; margin: 10px 0; }
  .edit-btn { background: #2196F3; color: white; }
  .delete-btn { background: #f44336; color: white; }
  .scheme-btn { background: #ff9800; color: white; }
  
  /* Form Styles */
  #stockForm { display:none; max-width: 500px; margin: 20px auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  #stockForm input, #stockForm select { width: 100%; margin: 8px 0; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
  #formTitle { text-align:center; margin-bottom:15px; font-weight:bold; color: #0d6efd; }
  .form-buttons { display: flex; gap: 10px; margin-top: 15px; }
  
  /* Summary Cards */
  .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0; }
  .summary-card { background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center; }
  .summary-card h3 { margin: 0 0 10px 0; color: #333; }
  .summary-card .value { font-size: 24px; font-weight: bold; color: #2196F3; }
  .summary-card.low-stock { border-left: 4px solid #f44336; }
  .summary-card.expired { border-left: 4px solid #ff9800; }
  .summary-card.scheme { border-left: 4px solid #4CAF50; }
  
  /* Tabs */
  .tabs { display: flex; margin: 20px 0; background: #fff; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  .tab { padding: 15px 20px; cursor: pointer; border: none; background: #f8f9fa; flex: 1; text-align: center; }
  .tab.active { background: #2196F3; color: white; }
  
  /* Loading and Error States */
  .loading { text-align: center; padding: 40px; color: #6c757d; }
  .error-message { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin: 10px 0; text-align: center; }
  
  /* Scheme Badges */
  .scheme-badge { background: #ff9800; color: white; padding: 3px 8px; border-radius: 10px; font-size: 0.8em; margin-left: 5px; }
  .free-badge { background: #4CAF50; color: white; padding: 2px 6px; border-radius: 8px; font-size: 0.7em; }
</style>
</head>
<body>

<h1>Stock Management</h1>

<!-- Tabs for different stock views -->
<div class="tabs">
  <button class="tab active" onclick="switchTab('all')">All Stock</button>
  <button class="tab" onclick="switchTab('low')">Low Stock</button>
  <button class="tab" onclick="switchTab('scheme')">Scheme Sales</button>
  <button class="tab" onclick="switchTab('expired')">Expired/Near Expiry</button>
</div>

<!-- Summary Cards -->
<div class="summary-cards">
  <div class="summary-card">
    <h3>Total Products</h3>
    <div class="value" id="totalProducts">0</div>
  </div>
  <div class="summary-card low-stock">
    <h3>Low Stock Items</h3>
    <div class="value" id="lowStockCount">0</div>
  </div>
  <div class="summary-card expired">
    <h3>Near Expiry</h3>
    <div class="value" id="expiryCount">0</div>
  </div>
  <div class="summary-card scheme">
    <h3>Scheme Liabilities</h3>
    <div class="value" id="schemeLiabilities">0</div>
  </div>
</div>

<!-- Action Buttons -->
<div style="display: flex; gap: 10px; margin: 20px 0;">
  <button class="btn add-btn" onclick="showAddStockForm()">+ Add Stock Entry</button>
  <button class="btn scheme-btn" onclick="showSchemeSaleForm()">+ Record Scheme Sale</button>
  <button class="btn edit-btn" onclick="showAdjustmentForm()">Stock Adjustment</button>
</div>

<!-- Main Stock Form -->
<div id="stockForm">
  <div id="formTitle">Add Stock Entry</div>
  <input type="hidden" id="stockId">
  <select id="productSelect" required>
    <option value="">Select Product</option>
  </select>
  <input type="text" id="batch" placeholder="Batch Number *" required>
  <input type="number" id="quantity" placeholder="Quantity *" min="1" required>
  <input type="text" id="invoice" placeholder="Invoice Reference">
  <input type="date" id="date" required>
  <select id="movementType">
    <option value="purchase">Purchase from Supplier</option>
    <option value="return">Return from Customer</option>
    <option value="adjustment">Stock Adjustment</option>
  </select>
  <div class="form-buttons">
    <button class="btn add-btn" onclick="saveStock()">Save Entry</button>
    <button class="btn delete-btn" onclick="hideStockForm()">Cancel</button>
  </div>
</div>

<!-- Scheme Sale Form -->
<div id="schemeSaleForm" style="display: none;">
  <div id="schemeFormTitle">Record Scheme Sale</div>
  <select id="schemeProductSelect" required>
    <option value="">Select Product</option>
  </select>
  <input type="text" id="stockistName" placeholder="Stockist Name *" required>
  <input type="number" id="billedQuantity" placeholder="Billed Quantity *" min="1" required>
  <div id="schemePreview" style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin: 10px 0; display: none;">
    <strong>Scheme Applied:</strong> <span id="schemeDetails"></span>
  </div>
  <input type="text" id="saleInvoice" placeholder="Sale Invoice Reference">
  <input type="date" id="saleDate" required>
  <div class="form-buttons">
    <button class="btn scheme-btn" onclick="saveSchemeSale()">Record Sale</button>
    <button class="btn delete-btn" onclick="hideSchemeForm()">Cancel</button>
  </div>
</div>

<!-- Stock Table -->
<div class="container">
  <table id="stockTable">
    <thead>
      <tr>
        <th>Product</th>
        <th>Batch</th>
        <th>Type</th>
        <th>Billed Qty</th>
        <th>Free Qty</th>
        <th>Total Qty</th>
        <th>Stock Impact</th>
        <th>Invoice</th>
        <th>Date</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script src="../js/firebase-config.js"></script>
<script src="../js/navigation.js"></script>
<script src="../js/stock.js"></script>

</body>
</html>